(()=>{const e="https://xidzach-ltd.herokuapp.com",t=io("/"),r={id:playerId,name:localStorage.getItem("name"),card:0,bet:0,status:0};function n(e){for(var t=[],r=0;r<e;r++)t.push('\n            <li class="card-list__item">\n                        <img src="/assets/img/0.png" alt="" class="card-list__item-img">\n\n            </li>\n            ');document.querySelector(".dealer .card-list").innerHTML=t.join(" ")}function a(e){var t=e.map((function(e){return`\n        <li class="card-list__item">\n                    <img src="/assets/img/${e}.png" alt="" class="card-list__item-img">\n\n        </li>\n        `}));document.querySelector(".dealer .card-list").innerHTML=t.join(" ")}function l(e,t=""){r.card=e.length;var n=document.querySelector(`.player${t} .card-list.player__card`),a=e.map((function(e){return`\n        <li class="card-list__item">\n        <img src="/assets/img/${e}.png" alt="" class="card-list__item-img">\n        </li>\n        `}));a.join(" "),n.innerHTML=a}function c(){var e=document.querySelector(".player");e.classList.contains("player--turn")&&e.classList.remove("player--turn"),e.classList.add("player--end-turn"),r.status=3}function o(){document.querySelector(".hit-btn").disabled=!0,document.querySelector(".done-btn").disabled=!0}function s(e){e.forEach((function(e){var t=+e.id,n=e.res;if(t==playerId){var a=document.querySelector(".player");switch(console.log("lose"),r.status=4,n){case-1:a.classList.add("player--lose");break;case 0:a.classList.add("player--draw");break;case 1:a.classList.add("player--win")}}else{var l=document.querySelector(`#player-${t}`);if(l)switch(l.classList.remove("player--end-turn"),n){case-1:l.classList.add("player--lose");break;case 0:l.classList.add("player--draw");break;case 1:l.classList.add("player--win")}}}))}document.querySelector(".player-area .player__name").textContent=localStorage.getItem("name"),t.emit("join-room",roomId,playerId),t.on("room-info",(function(e){!function(e){var r,a,l;l=e.dealer.name,document.querySelector(".dealer__name").textContent=l,n(e.dealer.card),a=(r=e.players).map((function(e){if(e.id==playerId)return"";var t="",r="";return e.bet>0&&(t="player--betted"),e.card>0&&(r="/assets/img/0.png"),`\n                <li class="player-item grid__col--2 ${t}" id="player-${e.id}">\n                    <span class="player-item__name">${e.name}</span>\n                    <img src="${r}" alt="" class="player-item__img">\n                    <div class="player-item__info">\n                    <div>\n                        <span>Bài: </span>\n                        <span class="player-item__card-number">${e.card}</span>\n                    </div>\n                    <div>\n                        <span>Cược: </span>\n                        <span class="player-item__bet">${e.bet}</span>\n                    </div>\n    \n                    </div>\n    \n                  \n                </li>\n              \n                `})),console.log(a),document.querySelector("ul.player-list").innerHTML=a.join(" "),r.forEach((function(e){var r=document.querySelector(`#player-${e.id}`);r&&e.id!=playerId&&r.addEventListener("click",(function(){!function(e){var r=document.querySelector(`#player-${e}`),n=Number(r.querySelector(".player-item__card-number").textContent);if(console.log("player item",r,n),n>0){var a=r.querySelector(".player-item__name").textContent;document.querySelector(".modal .player__name").textContent=a,t.emit("request-card",roomId,e)}}(+e.id)}))}))}(e)})),function(){const e=document.querySelector(".player-bet__btn");e.addEventListener("click",(function(){console.log("bet clicked");var n=document.querySelector(".player-bet__input");const a=Number(n.value);a&&a>0&&Number.isInteger(a)?(n.disabled=!0,e.disabled=!0,t.emit("player-bet",roomId,playerId,a),document.querySelector(".player").classList.add("player--betted"),r.bet=a,r.status=1):alert("mức cược cần lớn hơn 0 và số nguyên")})),t.on("player-betted",(function(e,t){var r=document.querySelector(`#player-${e}`);r&&(r.querySelector(".player-item__bet").textContent=t,r.classList.add("player--betted"))}))}(),t.on("dealer-leave-room",(function(){window.location.replace(`${e}/home/Chủ phòng đã rời đi`)})),document.querySelector(".exit__btn").addEventListener("click",(function(){console.log("exit clicked"),t.emit("exit-room",roomId,playerId),window.location.replace(`${e}/home`)})),t.on("card-dealt",(function(){t.emit("request-card",roomId,playerId)})),t.on("receive-card",(function(e,t){e==playerId?l(t):(document.querySelector(".modal").style.display="flex",l(t,".other-player__card"))})),t.on("winner-winner-chicken-dinner",(function(e,t){s(e),e[playerId]&&(r.status=4,a(t),console.log(t))})),function(){t.on("player-turn",(function(e){if(e==playerId)if(4!=r.status){var n=document.querySelector(".player");n.classList.contains("player--betted")&&n.classList.remove("player--betted"),n.classList.add("player--turn"),r.status=2,function(){const e=document.querySelector(".hit-btn"),t=document.querySelector(".done-btn");e.disabled=!1,t.disabled=!1}()}else t.emit("next-turn",roomId,playerId);else{var a=document.querySelector(`#player-${e}`);a&&(a.classList.contains("player--betted")&&a.classList.remove("player--betted"),a.classList.add("player--turn"),console.log("turn",a))}})),t.on("dealer-turn",(function(){document.querySelector(".dealer").classList.add("player--turn")})),t.on("card-hit",(function(e){l(e)})),t.on("turn-ended",(function(){c(),o(),t.emit("next-turn",roomId,playerId)})),t.on("player-card-change",(function(e,t){document.querySelector(`#player-${e}`).querySelector(".player-item__card-number").textContent=t})),t.on("dealer-card-change",(function(e,t){4!=r.status?n(e):a(t)})),t.on("player-finish",(function(e){if(e!=playerId){var t=document.querySelector(`#player-${e}`);t&&(t.classList.contains("player--turn")&&t.classList.remove("player--turn"),t.classList.add("player--end-turn"),console.log("turn",t))}}));const e=document.querySelector(".hit-btn"),s=document.querySelector(".done-btn");e.addEventListener("click",(function(){t.emit("hit-card",roomId,playerId),console.log("hit clicked")})),s.addEventListener("click",(function(){console.log("done clicked"),c(),o(),t.emit("next-turn",roomId,playerId)}))}(),t.on("show-card-result",(function(e,t,n){if(e==playerId){a(n);var l=document.querySelector(".player");switch(r.status=4,t){case-1:l.classList.add("player--lose");break;case 0:l.classList.add("player--draw");break;case 1:l.classList.add("player--win")}}else{var c=document.querySelector(`#player-${e}`);if(c)switch(c.classList.remove("player--end-turn"),t){case-1:c.classList.add("player--lose");break;case 0:c.classList.add("player--draw");break;case 1:c.classList.add("player--win")}}})),t.on("show-card-all",(function(e,t){a(t),document.querySelector(".dealer").classList.add("player--end-turn"),console.log(e),s(e)})),document.querySelector(".close-player-btn").addEventListener("click",(function(){document.querySelector(".modal").style.display="none"})),t.on("game-reset",(function(){document.querySelector(".player").className="grid__col--6 player",document.querySelector(".dealer").className="grid__col--6 dealer",document.querySelector(".player .card-list.player__card").innerHTML="",o(),document.querySelector(".player-bet__btn").disabled=!1,document.querySelector(".player-bet__input").disabled=!1,r.card=0,r.bet=0,r.status=0}))})();